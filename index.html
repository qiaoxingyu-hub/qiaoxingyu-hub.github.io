<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæ—¥å¿«ä¹ç”Ÿæ—¥å¿«ä¹å®è´ç”Ÿæ—¥å¿«ä¹ï¼</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- GSAP åŠ¨ç”»åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <!-- è‡ªå®šä¹‰ Tailwindé…ç½® -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B8B',
                        secondary: '#6BCEFF',
                        accent: '#FFD166',
                        success: '#06D6A0',
                        info: '#118AB2',
                        warning: '#FFD166',
                        danger: '#EF476F',
                        light: '#F8F9FA',
                        dark: '#212529'
                    },
                    fontFamily: {
                        sans: ['Comic Sans MS', 'Arial', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }
            .text-shadow-lg {
                text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.5);
            }
            .bg-gradient-birthday {
                background: linear-gradient(135deg, #FF6B8B 0%, #6BCEFF 100%);
            }
            .balloon {
                position: absolute;
                border-radius: 50%;
                opacity: 0.8;
                animation: float 6s infinite ease-in-out;
            }
            .confetti {
                position: absolute;
                width: 10px;
                height: 10px;
                opacity: 0;
                animation: confetti-fall 5s infinite ease-in-out;
            }
            @keyframes confetti-fall {
                0% {
                    transform: translateY(-100vh) rotate(0deg);
                    opacity: 1;
                }
                100% {
                    transform: translateY(100vh) rotate(720deg);
                    opacity: 0;
                }
            }
        }
    </style>
</head>
<body class="bg-pink-50 overflow-x-hidden min-h-screen">
    <!-- é¡¶éƒ¨è£…é¥° -->
    <div class="fixed top-0 left-0 right-0 h-20 bg-gradient-birthday z-10 shadow-md"></div>
    
    <!-- ä¸»è¦å†…å®¹å®¹å™¨ -->
    <div class="container mx-auto px-4 pt-24 pb-16 relative z-10">
        <!-- æ ‡é¢˜åŒº -->
        <header class="text-center mb-10">
            <h1 class="text-5xl md:text-6xl font-bold text-white text-shadow-lg mb-4 animate-float">
                ğŸ‰ ç”Ÿæ—¥å¿«ä¹ï¼ğŸ‰
            </h1>
            <p class="text-xl md:text-2xl text-pink-800 font-medium">
                æ„¿è¿™ä¸€å¤©å……æ»¡æ¬¢ç¬‘å’ŒæƒŠå–œï¼
            </p>
        </header>
        
        <!-- ç…§ç‰‡å±•ç¤ºåŒº -->
        <section class="bg-white rounded-2xl shadow-xl p-6 mb-10">
            <h2 class="text-2xl font-bold text-pink-600 mb-6 text-center">
                <i class="fa fa-camera mr-2"></i>ç¾å¥½å›å¿†
            </h2>
            
            <!-- ç…§ç‰‡è½®æ’­ -->
            <div class="relative overflow-hidden rounded-xl">
                <div id="photoCarousel" class="flex transition-transform duration-500 ease-in-out">
                    <!-- ç…§ç‰‡å°†é€šè¿‡ JavaScript åŠ¨æ€æ·»åŠ  -->
                </div>
                
                <!-- è½®æ’­æ§åˆ¶æŒ‰é’® -->
                <button id="prevBtn" class="absolute left-2 top-1/2 transform -translate-y-1/2 bg-white/80 hover:bg-white rounded-full p-2 shadow-md z-10">
                    <i class="fa fa-chevron-left text-pink-600"></i>
                </button>
                <button id="nextBtn" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-white/80 hover:bg-white rounded-full p-2 shadow-md z-10">
                    <i class="fa fa-chevron-right text-pink-600"></i>
                </button>
                
                <!-- è½®æ’­æŒ‡ç¤ºå™¨ -->
                <div class="absolute bottom-4 left-0 right-0 flex justify-center gap-2">
                    <!-- æŒ‡ç¤ºå™¨å°†é€šè¿‡ JavaScript åŠ¨æ€æ·»åŠ  -->
                </div>
            </div>
            
            <!-- ç…§ç‰‡ç½‘æ ¼ -->
            <div id="photoGrid" class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-8">
                <!-- ç¼©ç•¥å›¾å°†é€šè¿‡ JavaScript åŠ¨æ€æ·»åŠ  -->
            </div>
            
            <!-- æ·»åŠ ç…§ç‰‡æŒ‰é’® -->
            <div class="mt-8 text-center">
                <label for="photoUpload" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-3 px-6 rounded-full cursor-pointer transition-all duration-300 transform hover:scale-105">
                    <i class="fa fa-plus mr-2"></i>æ·»åŠ ç…§ç‰‡
                </label>
                <input type="file" id="photoUpload" accept="image/*" multiple class="hidden">
            </div>
        </section>
        
        <!-- ç”Ÿæ—¥ç¥ç¦åŒº -->
        <section class="bg-white rounded-2xl shadow-xl p-6 mb-10">
            <h2 class="text-2xl font-bold text-pink-600 mb-6 text-center">
                <i class="fa fa-heart mr-2"></i>ç”Ÿæ—¥ç¥ç¦
            </h2>
            
            <div class="bg-pink-100 rounded-xl p-6 mb-6">
                <p id="birthdayMessage" class="text-lg text-pink-900 italic">
                    <!-- ç”Ÿæ—¥ç¥ç¦å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                </p>
            </div>
            
            <!-- ç¼–è¾‘ç¥ç¦æŒ‰é’® -->
            <div class="text-center">
                <button id="editMessageBtn" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-full cursor-pointer transition-all duration-300">
                    <i class="fa fa-pencil mr-2"></i>ç¼–è¾‘ç¥ç¦
                </button>
            </div>
            
            <!-- ç¼–è¾‘ç¥ç¦è¡¨å• -->
            <div id="messageEditor" class="hidden mt-6">
                <textarea id="messageInput" class="w-full h-32 p-4 border-2 border-pink-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500" placeholder="å†™ä¸‹ä½ å¯¹å®è´çš„ç”Ÿæ—¥ç¥ç¦..."></textarea>
                <div class="flex justify-end gap-4 mt-4">
                    <button id="cancelEditBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-full cursor-pointer transition-all duration-300">
                        å–æ¶ˆ
                    </button>
                    <button id="saveMessageBtn" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-full cursor-pointer transition-all duration-300">
                        ä¿å­˜
                    </button>
                </div>
            </div>
        </section>
        
        <!-- èƒŒæ™¯éŸ³ä¹æ§åˆ¶åŒº -->
        <section class="bg-white rounded-2xl shadow-xl p-6">
            <h2 class="text-2xl font-bold text-pink-600 mb-6 text-center">
                <i class="fa fa-music mr-2"></i>ç”Ÿæ—¥éŸ³ä¹
            </h2>
            
            <!-- éŸ³é¢‘å…ƒç´  -->
            <audio id="birthdayAudio" preload="auto"></audio>
            
            <div class="flex flex-wrap justify-center gap-4">
                <button id="playHappyBirthday" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-full cursor-pointer transition-all duration-300 flex items-center">
                    <i class="fa fa-play mr-2"></i>ç”Ÿæ—¥å¿«ä¹æ­Œ
                </button>
                <button id="playChildrenSong" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-full cursor-pointer transition-all duration-300 flex items-center">
                    <i class="fa fa-play mr-2"></i>å„¿ç«¥æ¬¢ä¹æ›²
                </button>
                <div class="relative">
                    <label for="musicUpload" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-full cursor-pointer transition-all duration-300 flex items-center">
                        <i class="fa fa-upload mr-2"></i>ä¸Šä¼ éŸ³ä¹
                    </label>
                    <input type="file" id="musicUpload" accept="audio/*" class="hidden">
                </div>
            </div>
            
            <!-- éŸ³é¢‘æ§åˆ¶å™¨ -->
            <div id="audioControls" class="mt-6 hidden">
                <div class="flex items-center gap-4">
                    <button id="playPauseBtn" class="bg-pink-600 hover:bg-pink-700 text-white rounded-full w-10 h-10 flex items-center justify-center">
                        <i class="fa fa-play"></i>
                    </button>
                    <div class="flex-1">
                        <input type="range" id="volumeSlider" min="0" max="100" value="80" class="w-full">
                    </div>
                    <span id="currentTime" class="text-pink-600 font-medium">00:00</span>
                    <span class="text-pink-600">/</span>
                    <span id="totalTime" class="text-pink-600 font-medium">00:00</span>
                </div>
            </div>
        </section>
    </div>
    
    <!-- åº•éƒ¨è£…é¥° -->
    <div class="fixed bottom-0 left-0 right-0 h-16 bg-gradient-birthday z-10 shadow-md"></div>
    
    <!-- å…¨å±ç…§ç‰‡æŸ¥çœ‹å™¨ -->
    <div id="photoViewer" class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center">
        <button id="closeViewerBtn" class="absolute top-4 right-4 text-white text-3xl hover:text-pink-300 cursor-pointer">
            <i class="fa fa-times"></i>
        </button>
        <button id="prevPhotoBtn" class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-white/20 hover:bg-white/30 text-white text-3xl rounded-full w-12 h-12 flex items-center justify-center hover:scale-110 transition-all duration-300">
            <i class="fa fa-chevron-left"></i>
        </button>
        <button id="nextPhotoBtn" class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-white/20 hover:bg-white/30 text-white text-3xl rounded-full w-12 h-12 flex items-center justify-center hover:scale-110 transition-all duration-300">
            <i class="fa fa-chevron-right"></i>
        </button>
        <button id="deletePhotoBtn" class="absolute bottom-4 right-4 bg-red-500/80 hover:bg-red-600 text-white text-xl rounded-full px-4 py-2 flex items-center justify-center hover:scale-105 transition-all duration-300">
            <i class="fa fa-trash mr-2"></i> åˆ é™¤ç…§ç‰‡
        </button>
        <img id="viewerImage" src="" alt="å¤§å›¾é¢„è§ˆ" class="max-w-[90%] max-h-[90vh] object-contain">
    </div>
    
    <!-- ç¼–è¾‘ç¥ç¦å¼¹çª— -->
    <div id="messageModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 max-w-lg w-full mx-4">
            <h3 class="text-2xl font-bold text-pink-600 mb-6 text-center">ç¼–è¾‘ç”Ÿæ—¥ç¥ç¦</h3>
            <textarea id="modalMessageInput" class="w-full h-32 p-4 border-2 border-pink-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500" placeholder="å†™ä¸‹ä½ å¯¹å®è´çš„ç”Ÿæ—¥ç¥ç¦..."></textarea>
            <div class="flex justify-end gap-4 mt-6">
                <button id="modalCancelBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-full cursor-pointer transition-all duration-300">
                    å–æ¶ˆ
                </button>
                <button id="modalSaveBtn" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-full cursor-pointer transition-all duration-300">
                    ä¿å­˜
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // ä½¿ç”¨sessionStorageä»£æ›¿localStorageï¼Œé¿å…è·¨åŸŸé—®é¢˜
        let photos = JSON.parse(sessionStorage.getItem('birthdayPhotos')) || [
            { url: 'https://p11-doubao-search-sign.byteimg.com/tos-cn-i-6w9my0ksvp/f0c3712a8ce5479c92ff88ca84e1deff~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=gNblHFNyPk3GwWYLpvpaWnik1y4%3D', title: 'ç”Ÿæ—¥è›‹ç³•1' },
            { url: 'https://p11-doubao-search-sign.byteimg.com/tos-cn-i-6w9my0ksvp/95881b38b944401c95b674ce2572ac7d~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=BWc%2FXcnApLrpP84WHYSioOjv7So%3D', title: 'ç”Ÿæ—¥è›‹ç³•2' },
            { url: 'https://p11-doubao-search-sign.byteimg.com/tos-cn-i-6w9my0ksvp/0cfc9e098f334121bb4d638c65324bfe~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=aBWE6LA7xGu2XoVXx0x4Zzupnh4%3D', title: 'ç”Ÿæ—¥è›‹ç³•3' },
            { url: 'https://p11-doubao-search-sign.byteimg.com/tos-cn-i-6w9my0ksvp/a5a8efb54eb7406eabf5e02c13519f00~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=8JNOL4ry%2B7IFmaVimbqE6rJRwNw%3D', title: 'ç”Ÿæ—¥è›‹ç³•4' },
            { url: 'https://p26-doubao-search-sign.byteimg.com/labis/5ed9174075b8641991e50e1e5d6df8d3~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=aCUB9ksslZlaQqRLlICR6Xgk%2Bsg%3D', title: 'ç”Ÿæ—¥è›‹ç³•5' },
            { url: 'https://p26-doubao-search-sign.byteimg.com/labis/4f12a246d0c6ec6c828e7d3b40e3009b~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=8gfe%2FMaV%2Fkxb0CyCh4ZA4daf6g4%3D', title: 'ç”Ÿæ—¥æ°”çƒ1' },
            { url: 'https://p26-doubao-search-sign.byteimg.com/labis/352490d47c714e4b2b9f53c52198a5ad~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=ZImgQ%2BJwgZKWH4AkQwDdJEfPSiE%3D', title: 'ç”Ÿæ—¥æ°”çƒ2' },
            { url: 'https://p26-doubao-search-sign.byteimg.com/labis/e201533038f53c4e1d9fd2408a3dacce~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=PDX2fxNI0tbBqh1pvz4ccR4%2Fj9k%3D', title: 'ç”Ÿæ—¥æ°”çƒ3' },
            { url: 'https://p3-doubao-search-sign.byteimg.com/labis/98a26773eaa5674624abf5cddc40384c~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=q1llEa23PollzmQLxJuISXbQJJQ%3D', title: 'ç”Ÿæ—¥æ°”çƒ4' },
            { url: 'https://p3-doubao-search-sign.byteimg.com/labis/image/78abf6a0cc9343ed6faa2059f13e8ae0~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=cbHq4BkUMfiUXtTJyqXmHwuKGoY%3D', title: 'ç”Ÿæ—¥ç¤¼ç‰©1' },
            { url: 'https://p3-doubao-search-sign.byteimg.com/labis/b727cc9615780994b33eb3b3936aa61b~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=esshVWeiGjp0yQCyWt3XpEywDDM%3D', title: 'ç”Ÿæ—¥ç¤¼ç‰©2' },
            { url: 'https://p3-doubao-search-sign.byteimg.com/labis/e2e16ee9de25079f87647188c0a27ae9~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=XxdC6BaeZQn%2B6x%2FVPU4v2W1ewFI%3D', title: 'ç”Ÿæ—¥ç¤¼ç‰©3' }
        ];
        
        // ä½¿ç”¨sessionStorageå­˜å‚¨ç”Ÿæ—¥ç¥ç¦
        let birthdayMessage = sessionStorage.getItem('birthdayMessage') || 'äº²çˆ±çš„å®è´ï¼Œæ„¿ä½ çš„ç”Ÿæ—¥å……æ»¡é˜³å…‰ã€æ¬¢ç¬‘å’Œçˆ±ï¼æ„¿ä½ æ¯ä¸€å¤©éƒ½åƒä»Šå¤©ä¸€æ ·å¿«ä¹ï¼ğŸ‰ğŸ‚ğŸˆ';
        
        // éŸ³é¢‘å…ƒç´ 
        let audioElement = null;
        
        // å½“å‰è½®æ’­ç´¢å¼•
        let currentSlide = 0;
        
        // DOM å…ƒç´ 
        const photoCarousel = document.getElementById('photoCarousel');
        const photoGrid = document.getElementById('photoGrid');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const photoViewer = document.getElementById('photoViewer');
        const viewerImage = document.getElementById('viewerImage');
        const closeViewerBtn = document.getElementById('closeViewerBtn');
        const editMessageBtn = document.getElementById('editMessageBtn');
        const messageModal = document.getElementById('messageModal');
        const modalMessageInput = document.getElementById('modalMessageInput');
        const modalCancelBtn = document.getElementById('modalCancelBtn');
        const modalSaveBtn = document.getElementById('modalSaveBtn');
        const photoUpload = document.getElementById('photoUpload');
        
        // åˆå§‹åŒ–ç…§ç‰‡è½®æ’­
        function initCarousel() {
            photos.forEach((photo, index) => {
                const slide = document.createElement('div');
                slide.className = 'min-w-full h-80 md:h-96 relative';
                slide.innerHTML = `
                    <img src="${photo.url}" alt="${photo.title}" class="w-full h-full object-cover rounded-xl cursor-pointer">
                    <button class="absolute top-2 right-2 bg-red-500/70 hover:bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center transition-all duration-300 opacity-0 hover:opacity-100">
                        <i class="fa fa-trash"></i>
                    </button>
                `;
                slide.querySelector('img').addEventListener('click', () => openPhotoViewer(photo.url, index));
                slide.querySelector('button').addEventListener('click', (e) => {
                    e.stopPropagation();
                    deletePhoto(index);
                });
                photoCarousel.appendChild(slide);
                
                // æ·»åŠ æŒ‡ç¤ºå™¨
                const indicator = document.createElement('div');
                indicator.className = `w-3 h-3 rounded-full ${index === 0 ? 'bg-pink-600' : 'bg-gray-300'} cursor-pointer`;
                indicator.addEventListener('click', () => goToSlide(index));
                document.querySelector('.flex.justify-center.gap-2').appendChild(indicator);
            });
            
            // è®¾ç½®è½®æ’­è‡ªåŠ¨æ’­æ”¾
            setInterval(nextSlide, 5000);
        }
        
        // åˆå§‹åŒ–ç…§ç‰‡ç½‘æ ¼
        function initPhotoGrid() {
            photos.forEach((photo, index) => {
                const thumbnail = document.createElement('div');
                thumbnail.className = 'rounded-lg overflow-hidden shadow-md cursor-pointer transform transition-transform duration-300 hover:scale-105 relative';
                thumbnail.innerHTML = `
                    <img src="${photo.url}" alt="${photo.title}" class="w-full h-40 object-cover">
                    <button class="absolute top-2 right-2 bg-red-500/70 hover:bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center transition-all duration-300 opacity-0 hover:opacity-100">
                        <i class="fa fa-trash"></i>
                    </button>
                `;
                thumbnail.querySelector('img').addEventListener('click', () => openPhotoViewer(photo.url, index));
                thumbnail.querySelector('button').addEventListener('click', (e) => {
                    e.stopPropagation();
                    deletePhoto(index);
                });
                photoGrid.appendChild(thumbnail);
            });
        }
        
        // è½®æ’­ä¸‹ä¸€å¼ 
        function nextSlide() {
            currentSlide = (currentSlide + 1) % photos.length;
            updateCarousel();
        }
        
        // è½®æ’­ä¸Šä¸€å¼ 
        function prevSlide() {
            currentSlide = (currentSlide - 1 + photos.length) % photos.length;
            updateCarousel();
        }
        
        // è·³è½¬åˆ°æŒ‡å®šå¹»ç¯ç‰‡
        function goToSlide(index) {
            currentSlide = index;
            updateCarousel();
        }
        
        // æ›´æ–°è½®æ’­çŠ¶æ€
        function updateCarousel() {
            photoCarousel.style.transform = `translateX(-${currentSlide * 100}%)`;
            
            // æ›´æ–°æŒ‡ç¤ºå™¨
            const indicators = document.querySelectorAll('.flex.justify-center.gap-2 div');
            indicators.forEach((indicator, index) => {
                indicator.className = `w-3 h-3 rounded-full ${index === currentSlide ? 'bg-pink-600' : 'bg-gray-300'} cursor-pointer`;
            });
        }
        
        // æ‰“å¼€ç…§ç‰‡æŸ¥çœ‹å™¨
        function openPhotoViewer(url, index) {
            viewerImage.src = url;
            photoViewer.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            // ä¿å­˜å½“å‰æŸ¥çœ‹çš„ç…§ç‰‡ç´¢å¼•
            photoViewer.dataset.currentIndex = index;
        }
        
        // å…³é—­ç…§ç‰‡æŸ¥çœ‹å™¨
        function closePhotoViewer() {
            photoViewer.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
        
        // æ‰“å¼€ç¥ç¦ç¼–è¾‘å¼¹çª—
        function openMessageEditor() {
            modalMessageInput.value = document.getElementById('birthdayMessage').textContent.trim();
            messageModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        // å…³é—­ç¥ç¦ç¼–è¾‘å¼¹çª—
        function closeMessageEditor() {
            messageModal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
        
        // ä¿å­˜ç”Ÿæ—¥ç¥ç¦
        function saveMessage() {
            const newMessage = modalMessageInput.value.trim();
            if (newMessage) {
                // æ›´æ–°æ˜¾ç¤º
                document.getElementById('birthdayMessage').textContent = newMessage;
                
                // ä¿å­˜åˆ°sessionStorage
                sessionStorage.setItem('birthdayMessage', newMessage);
                
                // æ›´æ–°å˜é‡
                birthdayMessage = newMessage;
                
                closeMessageEditor();
                
                // æ˜¾ç¤ºä¿å­˜æˆåŠŸåŠ¨ç”»
                const saveNotification = document.createElement('div');
                saveNotification.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-float';
                saveNotification.textContent = 'ç¥ç¦å·²ä¿å­˜ï¼';
                document.body.appendChild(saveNotification);
                
                // 3ç§’åç§»é™¤é€šçŸ¥
                setTimeout(() => {
                    saveNotification.remove();
                }, 3000);
            }
        }
        
        // å¤„ç†ç…§ç‰‡ä¸Šä¼ 
        function handlePhotoUpload(event) {
            const files = event.target.files;
            if (files.length > 0) {
                // æ˜¾ç¤ºä¸Šä¼ ä¸­åŠ¨ç”»
                const uploadNotification = document.createElement('div');
                uploadNotification.className = 'fixed bottom-4 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-float';
                uploadNotification.textContent = 'æ­£åœ¨ä¸Šä¼ ç…§ç‰‡...';
                document.body.appendChild(uploadNotification);
                
                // å¤„ç†æ¯ä¸ªä¸Šä¼ çš„æ–‡ä»¶
                Array.from(files).forEach(file => {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        // åˆ›å»ºæ–°ç…§ç‰‡å¯¹è±¡
                        const newPhoto = {
                            url: e.target.result,
                            title: file.name
                        };
                        
                        // æ·»åŠ åˆ°ç…§ç‰‡æ•°ç»„
                        photos.push(newPhoto);
                        
                        // ä¿å­˜åˆ°sessionStorage
                        savePhotosToSessionStorage();
                        
                        // æ›´æ–°UI
                        updatePhotoDisplay();
                    };
                    
                    // è¯»å–æ–‡ä»¶ä¸ºDataURL
                    reader.readAsDataURL(file);
                });
                
                // æ¨¡æ‹Ÿä¸Šä¼ å»¶è¿Ÿåæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                setTimeout(() => {
                    uploadNotification.remove();
                    
                    // æ˜¾ç¤ºä¸Šä¼ æˆåŠŸåŠ¨ç”»
                    const successNotification = document.createElement('div');
                    successNotification.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-float';
                    successNotification.textContent = `æˆåŠŸä¸Šä¼  ${files.length} å¼ ç…§ç‰‡ï¼`;
                    document.body.appendChild(successNotification);
                    
                    // 3ç§’åç§»é™¤é€šçŸ¥
                    setTimeout(() => {
                        successNotification.remove();
                    }, 3000);
                }, 1000);
            }
        }
        
        // ä¿å­˜ç…§ç‰‡æ•°æ®åˆ°sessionStorage
        function savePhotosToSessionStorage() {
            sessionStorage.setItem('birthdayPhotos', JSON.stringify(photos));
        }
        
        // æ›´æ–°ç…§ç‰‡æ˜¾ç¤º
        function updatePhotoDisplay() {
            // æ¸…ç©ºç°æœ‰å†…å®¹
            photoCarousel.innerHTML = '';
            photoGrid.innerHTML = '';
            document.querySelector('.flex.justify-center.gap-2').innerHTML = '';
            
            // é‡æ–°åˆå§‹åŒ–è½®æ’­å’Œç½‘æ ¼
            initCarousel();
            initPhotoGrid();
            
            // é‡ç½®å½“å‰å¹»ç¯ç‰‡ç´¢å¼•
            currentSlide = 0;
            updateCarousel();
        }
        
        // åˆ é™¤ç…§ç‰‡
        function deletePhoto(index) {
            // ä»æ•°ç»„ä¸­åˆ é™¤ç…§ç‰‡
            photos.splice(index, 1);
            
            // ä¿å­˜åˆ°sessionStorage
            savePhotosToSessionStorage();
            
            // æ›´æ–°UI
            updatePhotoDisplay();
            
            // æ˜¾ç¤ºåˆ é™¤æˆåŠŸåŠ¨ç”»
            const deleteNotification = document.createElement('div');
            deleteNotification.className = 'fixed bottom-4 right-4 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-float';
            deleteNotification.textContent = 'ç…§ç‰‡å·²åˆ é™¤ï¼';
            document.body.appendChild(deleteNotification);
            
            // 3ç§’åç§»é™¤é€šçŸ¥
            setTimeout(() => {
                deleteNotification.remove();
            }, 3000);
        }
        
        // åˆ›å»ºéšæœºæ°”çƒ
        function createBalloon() {
            const balloon = document.createElement('div');
            balloon.className = 'balloon';
            
            // éšæœºå¤§å°
            const size = Math.floor(Math.random() * 60) + 40;
            balloon.style.width = `${size}px`;
            balloon.style.height = `${size}px`;
            
            // éšæœºé¢œè‰²
            const colors = ['#FF6B8B', '#6BCEFF', '#FFD166', '#06D6A0', '#EF476F', '#118AB2'];
            balloon.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            
            // éšæœºä½ç½®
            const posX = Math.floor(Math.random() * window.innerWidth);
            balloon.style.left = `${posX}px`;
            balloon.style.bottom = '-100px';
            
            // éšæœºåŠ¨ç”»å»¶è¿Ÿ
            balloon.style.animationDelay = `${Math.random() * 10}s`;
            
            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(balloon);
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤
            setTimeout(() => {
                balloon.remove();
            }, 10000);
        }
        
        // åˆ›å»ºéšæœºå½©å¸¦
        function createConfetti() {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            
            // éšæœºé¢œè‰²
            const colors = ['#FF6B8B', '#6BCEFF', '#FFD166', '#06D6A0', '#EF476F', '#118AB2', '#FF8C42', '#A77DC2'];
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            
            // éšæœºä½ç½®
            const posX = Math.floor(Math.random() * window.innerWidth);
            confetti.style.left = `${posX}px`;
            
            // éšæœºåŠ¨ç”»å»¶è¿Ÿå’ŒæŒç»­æ—¶é—´
            confetti.style.animationDelay = `${Math.random() * 5}s`;
            confetti.style.animationDuration = `${Math.random() * 5 + 5}s`;
            
            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(confetti);
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤
            setTimeout(() => {
                confetti.remove();
            }, 10000);
        }
        
        // æ˜¾ç¤ºä¸Šä¸€å¼ ç…§ç‰‡
        function showPrevPhoto() {
            const currentIndex = parseInt(photoViewer.dataset.currentIndex);
            const newIndex = (currentIndex - 1 + photos.length) % photos.length;
            viewerImage.src = photos[newIndex].url;
            photoViewer.dataset.currentIndex = newIndex;
        }
        
        // æ˜¾ç¤ºä¸‹ä¸€å¼ ç…§ç‰‡
        function showNextPhoto() {
            const currentIndex = parseInt(photoViewer.dataset.currentIndex);
            const newIndex = (currentIndex + 1) % photos.length;
            viewerImage.src = photos[newIndex].url;
            photoViewer.dataset.currentIndex = newIndex;
        }
        
        // åˆ é™¤å½“å‰æŸ¥çœ‹çš„ç…§ç‰‡
        function deleteCurrentPhoto() {
            const currentIndex = parseInt(photoViewer.dataset.currentIndex);
            deletePhoto(currentIndex);
            closePhotoViewer();
        }
        
        // å¤„ç†é”®ç›˜å¯¼èˆª
        function handleKeyNavigation(event) {
            if (!photoViewer.classList.contains('hidden')) {
                switch (event.key) {
                    case 'ArrowLeft':
                        showPrevPhoto();
                        break;
                    case 'ArrowRight':
                        showNextPhoto();
                        break;
                    case 'Escape':
                        closePhotoViewer();
                        break;
                    case 'Delete':
                        deleteCurrentPhoto();
                        break;
                }
            }
        }
        
        // æ’­æ”¾éŸ³é¢‘
        function playAudio(type) {
            // æ¨¡æ‹ŸéŸ³é¢‘æº
            const audioSources = {
                'ç”Ÿæ—¥å¿«ä¹æ­Œ': 'https://example.com/happy-birthday.mp3',
                'å„¿ç«¥æ¬¢ä¹æ›²': 'https://example.com/children-song.mp3'
            };
            
            // æ£€æŸ¥æ˜¯å¦æ”¯æŒéŸ³é¢‘æ’­æ”¾
            if (!audioElement) {
                showNotification('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾', 'error');
                return;
            }
            
            try {
                // è®¾ç½®éŸ³é¢‘æº
                audioElement.src = audioSources[type];
                
                // å°è¯•æ’­æ”¾
                audioElement.play()
                    .then(() => {
                        document.getElementById('playPauseBtn').innerHTML = '<i class="fa fa-pause"></i>';
                        showNotification(`æ­£åœ¨æ’­æ”¾: ${type}`, 'success');
                    })
                    .catch(error => {
                        console.error('æ’­æ”¾å¤±è´¥:', error);
                        showNotification('è¯·ç‚¹å‡»é¡µé¢åå†å°è¯•æ’­æ”¾éŸ³ä¹', 'warning');
                        
                        // æä¾›ä¸€ä¸ªå¤‡ç”¨æŒ‰é’®
                        const playButton = document.createElement('div');
                        playButton.className = 'fixed bottom-20 right-4 bg-pink-600 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-float';
                        playButton.innerHTML = '<i class="fa fa-play mr-2"></i>ç‚¹å‡»æ’­æ”¾éŸ³ä¹';
                        playButton.addEventListener('click', () => {
                            audioElement.play()
                                .then(() => {
                                    document.getElementById('playPauseBtn').innerHTML = '<i class="fa fa-pause"></i>';
                                    playButton.remove();
                                    showNotification(`æ­£åœ¨æ’­æ”¾: ${type}`, 'success');
                                })
                                .catch(err => {
                                    showNotification('æ’­æ”¾å¤±è´¥ï¼Œè¯·ç¨åå†è¯•', 'error');
                                    console.error('å†æ¬¡å°è¯•æ’­æ”¾å¤±è´¥:', err);
                                });
                        });
                        document.body.appendChild(playButton);
                    });
            } catch (error) {
                console.error('éŸ³é¢‘æ’­æ”¾é”™è¯¯:', error);
                showNotification('éŸ³é¢‘æ’­æ”¾å‡ºé”™ï¼Œè¯·ç¨åå†è¯•', 'error');
            }
        }
        
        // å¤„ç†éŸ³ä¹ä¸Šä¼ 
        function handleMusicUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        audioElement.src = e.target.result;
                        audioElement.play()
                            .then(() => {
                                document.getElementById('playPauseBtn').innerHTML = '<i class="fa fa-pause"></i>';
                                showNotification('æ­£åœ¨æ’­æ”¾æ‚¨ä¸Šä¼ çš„éŸ³ä¹', 'success');
                            })
                            .catch(error => {
                                console.error('æ’­æ”¾ä¸Šä¼ éŸ³ä¹å¤±è´¥:', error);
                                showNotification('è¯·ç‚¹å‡»é¡µé¢åå†å°è¯•æ’­æ”¾éŸ³ä¹', 'warning');
                            });
                    } catch (error) {
                        console.error('å¤„ç†ä¸Šä¼ éŸ³ä¹é”™è¯¯:', error);
                        showNotification('æ— æ³•å¤„ç†ä¸Šä¼ çš„éŸ³ä¹æ–‡ä»¶', 'error');
                    }
                };
                
                reader.onerror = function() {
                    showNotification('è¯»å–éŸ³ä¹æ–‡ä»¶æ—¶å‡ºé”™', 'error');
                };
                
                reader.readAsDataURL(file);
            }
        }
        
        // åˆ‡æ¢æ’­æ”¾/æš‚åœ
        function togglePlayPause() {
            if (!audioElement) return;
            
            try {
                if (audioElement.paused) {
                    audioElement.play()
                        .then(() => {
                            document.getElementById('playPauseBtn').innerHTML = '<i class="fa fa-pause"></i>';
                        })
                        .catch(error => {
                            console.error('æ’­æ”¾å¤±è´¥:', error);
                            showNotification('è¯·ç‚¹å‡»é¡µé¢åå†å°è¯•æ’­æ”¾éŸ³ä¹', 'warning');
                        });
                } else {
                    audioElement.pause();
                    document.getElementById('playPauseBtn').innerHTML = '<i class="fa fa-play"></i>';
                }
            } catch (error) {
                console.error('åˆ‡æ¢æ’­æ”¾çŠ¶æ€é”™è¯¯:', error);
                showNotification('æ“ä½œå‡ºé”™ï¼Œè¯·ç¨åå†è¯•', 'error');
            }
        }
        
        // è°ƒæ•´éŸ³é‡
        function adjustVolume() {
            if (!audioElement) return;
            
            try {
                const volume = document.getElementById('volumeSlider').value / 100;
                audioElement.volume = volume;
            } catch (error) {
                console.error('è°ƒæ•´éŸ³é‡é”™è¯¯:', error);
            }
        }
        
        // æ›´æ–°éŸ³é¢‘è¿›åº¦
        function updateAudioProgress() {
            if (!audioElement) return;
            
            try {
                const currentMinutes = Math.floor(audioElement.currentTime / 60);
                const currentSeconds = Math.floor(audioElement.currentTime % 60);
                const totalMinutes = Math.floor(audioElement.duration / 60);
                const totalSeconds = Math.floor(audioElement.duration % 60);
                
                document.getElementById('currentTime').textContent = 
                    `${currentMinutes.toString().padStart(2, '0')}:${currentSeconds.toString().padStart(2, '0')}`;
                document.getElementById('totalTime').textContent = 
                    `${totalMinutes.toString().padStart(2, '0')}:${totalSeconds.toString().padStart(2, '0')}`;
            } catch (error) {
                // å¿½ç•¥NaNé”™è¯¯
                if (!isNaN(error)) {
                    console.error('æ›´æ–°éŸ³é¢‘è¿›åº¦é”™è¯¯:', error);
                }
            }
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            
            // è®¾ç½®æ ·å¼
            let bgColor = 'bg-blue-500';
            if (type === 'success') bgColor = 'bg-green-500';
            if (type === 'error') bgColor = 'bg-red-500';
            if (type === 'warning') bgColor = 'bg-yellow-500';
            
            notification.className = `fixed bottom-4 right-4 ${bgColor} text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-float`;
            notification.textContent = message;
            
            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(notification);
            
            // 3ç§’åç§»é™¤
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // åˆå§‹åŒ–è½®æ’­å’Œç½‘æ ¼
            initCarousel();
            initPhotoGrid();
            
            // åŠ è½½ä¿å­˜çš„ç”Ÿæ—¥ç¥ç¦
            document.getElementById('birthdayMessage').textContent = birthdayMessage;
            
            // ç»‘å®šäº‹ä»¶
            prevBtn.addEventListener('click', prevSlide);
            nextBtn.addEventListener('click', nextSlide);
            closeViewerBtn.addEventListener('click', closePhotoViewer);
            editMessageBtn.addEventListener('click', openMessageEditor);
            modalCancelBtn.addEventListener('click', closeMessageEditor);
            modalSaveBtn.addEventListener('click', saveMessage);
            photoUpload.addEventListener('change', handlePhotoUpload);
            
            // ç…§ç‰‡æŸ¥çœ‹å™¨å¯¼èˆªæŒ‰é’®
            document.getElementById('prevPhotoBtn').addEventListener('click', showPrevPhoto);
            document.getElementById('nextPhotoBtn').addEventListener('click', showNextPhoto);
            document.getElementById('deletePhotoBtn').addEventListener('click', deleteCurrentPhoto);
            
            // é”®ç›˜å¯¼èˆª
            document.addEventListener('keydown', handleKeyNavigation);
            
            // éŸ³é¢‘ç›¸å…³äº‹ä»¶
            document.getElementById('playHappyBirthday').addEventListener('click', () => playAudio('ç”Ÿæ—¥å¿«ä¹æ­Œ'));
            document.getElementById('playChildrenSong').addEventListener('click', () => playAudio('å„¿ç«¥æ¬¢ä¹æ›²'));
            document.getElementById('musicUpload').addEventListener('change', handleMusicUpload);
            document.getElementById('playPauseBtn').addEventListener('click', togglePlayPause);
            document.getElementById('volumeSlider').addEventListener('input', adjustVolume);
            
            // è·å–éŸ³é¢‘å…ƒç´ 
            audioElement = document.getElementById('birthdayAudio');
            
            // éŸ³é¢‘æ—¶é—´æ›´æ–°äº‹ä»¶
            audioElement.addEventListener('timeupdate', updateAudioProgress);
            
            // éŸ³é¢‘ç»“æŸäº‹ä»¶
            audioElement.addEventListener('ended', () => {
                document.getElementById('playPauseBtn').innerHTML = '<i class="fa fa-play"></i>';
            });
            
            // æ˜¾ç¤ºéŸ³é¢‘æ§åˆ¶å™¨
            document.getElementById('audioControls').classList.remove('hidden');
            
            // ç‚¹å‡»é¡µé¢åˆ›å»ºæ°”çƒå’Œå½©å¸¦
            document.addEventListener('click', (event) => {
                // æ’é™¤ç‰¹å®šå…ƒç´ 
                const excludedElements = ['button', 'input', 'textarea', '.balloon', '.confetti'];
                const isExcluded = excludedElements.some(selector => 
                    event.target.matches(selector) || event.target.closest(selector)
                );
                
                if (!isExcluded) {
                    createBalloon();
                    createConfetti();
                }
            });
            
            // è‡ªåŠ¨åˆ›å»ºæ°”çƒå’Œå½©å¸¦
            setInterval(() => {
                createBalloon();
                createConfetti();
            }, 2000);
        });
    </script>
</body>
</html>
