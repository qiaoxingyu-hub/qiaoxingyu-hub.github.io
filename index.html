<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生日快乐生日快乐宝贝生日快乐！</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- GSAP 动画库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <!-- 自定义 Tailwind配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B8B',
                        secondary: '#6BCEFF',
                        accent: '#FFD166',
                        success: '#06D6A0',
                        info: '#118AB2',
                        warning: '#FFD166',
                        danger: '#EF476F',
                        light: '#F8F9FA',
                        dark: '#212529'
                    },
                    fontFamily: {
                        sans: ['Comic Sans MS', 'Arial', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }
            .text-shadow-lg {
                text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.5);
            }
            .bg-gradient-birthday {
                background: linear-gradient(135deg, #FF6B8B 0%, #6BCEFF 100%);
            }
            .balloon {
                position: absolute;
                border-radius: 50%;
                opacity: 0.8;
                animation: float 6s infinite ease-in-out;
            }
            .confetti {
                position: absolute;
                width: 10px;
                height: 10px;
                opacity: 0;
                animation: confetti-fall 5s infinite ease-in-out;
            }
            @keyframes confetti-fall {
                0% {
                    transform: translateY(-100vh) rotate(0deg);
                    opacity: 1;
                }
                100% {
                    transform: translateY(100vh) rotate(720deg);
                    opacity: 0;
                }
            }
        }
    </style>
</head>
<body class="bg-pink-50 overflow-x-hidden min-h-screen">
    <!-- 顶部装饰 -->
    <div class="fixed top-0 left-0 right-0 h-20 bg-gradient-birthday z-10 shadow-md"></div>
    
    <!-- 主要内容容器 -->
    <div class="container mx-auto px-4 pt-24 pb-16 relative z-10">
        <!-- 标题区 -->
        <header class="text-center mb-10">
            <h1 class="text-5xl md:text-6xl font-bold text-white text-shadow-lg mb-4 animate-float">
                🎉 生日快乐！🎉
            </h1>
            <p class="text-xl md:text-2xl text-pink-800 font-medium">
                愿这一天充满欢笑和惊喜！
            </p>
        </header>
        
        <!-- 照片展示区 -->
        <section class="bg-white rounded-2xl shadow-xl p-6 mb-10">
            <h2 class="text-2xl font-bold text-pink-600 mb-6 text-center">
                <i class="fa fa-camera mr-2"></i>美好回忆
            </h2>
            
            <!-- 照片轮播 -->
            <div class="relative overflow-hidden rounded-xl">
                <div id="photoCarousel" class="flex transition-transform duration-500 ease-in-out">
                    <!-- 照片将通过 JavaScript 动态添加 -->
                </div>
                
                <!-- 轮播控制按钮 -->
                <button id="prevBtn" class="absolute left-2 top-1/2 transform -translate-y-1/2 bg-white/80 hover:bg-white rounded-full p-2 shadow-md z-10">
                    <i class="fa fa-chevron-left text-pink-600"></i>
                </button>
                <button id="nextBtn" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-white/80 hover:bg-white rounded-full p-2 shadow-md z-10">
                    <i class="fa fa-chevron-right text-pink-600"></i>
                </button>
                
                <!-- 轮播指示器 -->
                <div class="absolute bottom-4 left-0 right-0 flex justify-center gap-2">
                    <!-- 指示器将通过 JavaScript 动态添加 -->
                </div>
            </div>
            
            <!-- 照片网格 -->
            <div id="photoGrid" class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-8">
                <!-- 缩略图将通过 JavaScript 动态添加 -->
            </div>
            
            <!-- 添加照片按钮 -->
            <div class="mt-8 text-center">
                <label for="photoUpload" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-3 px-6 rounded-full cursor-pointer transition-all duration-300 transform hover:scale-105">
                    <i class="fa fa-plus mr-2"></i>添加照片
                </label>
                <input type="file" id="photoUpload" accept="image/*" multiple class="hidden">
            </div>
        </section>
        
        <!-- 生日祝福区 -->
        <section class="bg-white rounded-2xl shadow-xl p-6 mb-10">
            <h2 class="text-2xl font-bold text-pink-600 mb-6 text-center">
                <i class="fa fa-heart mr-2"></i>生日祝福
            </h2>
            
            <div class="bg-pink-100 rounded-xl p-6 mb-6">
                <p id="birthdayMessage" class="text-lg text-pink-900 italic">
                    <!-- 生日祝福将通过JavaScript动态加载 -->
                </p>
            </div>
            
            <!-- 编辑祝福按钮 -->
            <div class="text-center">
                <button id="editMessageBtn" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-full cursor-pointer transition-all duration-300">
                    <i class="fa fa-pencil mr-2"></i>编辑祝福
                </button>
            </div>
            
            <!-- 编辑祝福表单 -->
            <div id="messageEditor" class="hidden mt-6">
                <textarea id="messageInput" class="w-full h-32 p-4 border-2 border-pink-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500" placeholder="写下你对宝贝的生日祝福..."></textarea>
                <div class="flex justify-end gap-4 mt-4">
                    <button id="cancelEditBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-full cursor-pointer transition-all duration-300">
                        取消
                    </button>
                    <button id="saveMessageBtn" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-full cursor-pointer transition-all duration-300">
                        保存
                    </button>
                </div>
            </div>
        </section>
        
        <!-- 背景音乐控制区 -->
        <section class="bg-white rounded-2xl shadow-xl p-6">
            <h2 class="text-2xl font-bold text-pink-600 mb-6 text-center">
                <i class="fa fa-music mr-2"></i>生日音乐
            </h2>
            
            <!-- 音频元素 -->
            <audio id="birthdayAudio" preload="auto"></audio>
            
            <div class="flex flex-wrap justify-center gap-4">
                <button id="playHappyBirthday" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-full cursor-pointer transition-all duration-300 flex items-center">
                    <i class="fa fa-play mr-2"></i>生日快乐歌
                </button>
                <button id="playChildrenSong" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-full cursor-pointer transition-all duration-300 flex items-center">
                    <i class="fa fa-play mr-2"></i>儿童欢乐曲
                </button>
                <div class="relative">
                    <label for="musicUpload" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-full cursor-pointer transition-all duration-300 flex items-center">
                        <i class="fa fa-upload mr-2"></i>上传音乐
                    </label>
                    <input type="file" id="musicUpload" accept="audio/*" class="hidden">
                </div>
            </div>
            
            <!-- 音频控制器 -->
            <div id="audioControls" class="mt-6 hidden">
                <div class="flex items-center gap-4">
                    <button id="playPauseBtn" class="bg-pink-600 hover:bg-pink-700 text-white rounded-full w-10 h-10 flex items-center justify-center">
                        <i class="fa fa-play"></i>
                    </button>
                    <div class="flex-1">
                        <input type="range" id="volumeSlider" min="0" max="100" value="80" class="w-full">
                    </div>
                    <span id="currentTime" class="text-pink-600 font-medium">00:00</span>
                    <span class="text-pink-600">/</span>
                    <span id="totalTime" class="text-pink-600 font-medium">00:00</span>
                </div>
            </div>
        </section>
    </div>
    
    <!-- 底部装饰 -->
    <div class="fixed bottom-0 left-0 right-0 h-16 bg-gradient-birthday z-10 shadow-md"></div>
    
    <!-- 全屏照片查看器 -->
    <div id="photoViewer" class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center">
        <button id="closeViewerBtn" class="absolute top-4 right-4 text-white text-3xl hover:text-pink-300 cursor-pointer">
            <i class="fa fa-times"></i>
        </button>
        <button id="prevPhotoBtn" class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-white/20 hover:bg-white/30 text-white text-3xl rounded-full w-12 h-12 flex items-center justify-center hover:scale-110 transition-all duration-300">
            <i class="fa fa-chevron-left"></i>
        </button>
        <button id="nextPhotoBtn" class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-white/20 hover:bg-white/30 text-white text-3xl rounded-full w-12 h-12 flex items-center justify-center hover:scale-110 transition-all duration-300">
            <i class="fa fa-chevron-right"></i>
        </button>
        <button id="deletePhotoBtn" class="absolute bottom-4 right-4 bg-red-500/80 hover:bg-red-600 text-white text-xl rounded-full px-4 py-2 flex items-center justify-center hover:scale-105 transition-all duration-300">
            <i class="fa fa-trash mr-2"></i> 删除照片
        </button>
        <img id="viewerImage" src="" alt="大图预览" class="max-w-[90%] max-h-[90vh] object-contain">
    </div>
    
    <!-- 编辑祝福弹窗 -->
    <div id="messageModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 max-w-lg w-full mx-4">
            <h3 class="text-2xl font-bold text-pink-600 mb-6 text-center">编辑生日祝福</h3>
            <textarea id="modalMessageInput" class="w-full h-32 p-4 border-2 border-pink-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500" placeholder="写下你对宝贝的生日祝福..."></textarea>
            <div class="flex justify-end gap-4 mt-6">
                <button id="modalCancelBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-full cursor-pointer transition-all duration-300">
                    取消
                </button>
                <button id="modalSaveBtn" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-full cursor-pointer transition-all duration-300">
                    保存
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // 使用sessionStorage代替localStorage，避免跨域问题
        let photos = JSON.parse(sessionStorage.getItem('birthdayPhotos')) || [
            { url: 'https://p11-doubao-search-sign.byteimg.com/tos-cn-i-6w9my0ksvp/f0c3712a8ce5479c92ff88ca84e1deff~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=gNblHFNyPk3GwWYLpvpaWnik1y4%3D', title: '生日蛋糕1' },
            { url: 'https://p11-doubao-search-sign.byteimg.com/tos-cn-i-6w9my0ksvp/95881b38b944401c95b674ce2572ac7d~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=BWc%2FXcnApLrpP84WHYSioOjv7So%3D', title: '生日蛋糕2' },
            { url: 'https://p11-doubao-search-sign.byteimg.com/tos-cn-i-6w9my0ksvp/0cfc9e098f334121bb4d638c65324bfe~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=aBWE6LA7xGu2XoVXx0x4Zzupnh4%3D', title: '生日蛋糕3' },
            { url: 'https://p11-doubao-search-sign.byteimg.com/tos-cn-i-6w9my0ksvp/a5a8efb54eb7406eabf5e02c13519f00~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=8JNOL4ry%2B7IFmaVimbqE6rJRwNw%3D', title: '生日蛋糕4' },
            { url: 'https://p26-doubao-search-sign.byteimg.com/labis/5ed9174075b8641991e50e1e5d6df8d3~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=aCUB9ksslZlaQqRLlICR6Xgk%2Bsg%3D', title: '生日蛋糕5' },
            { url: 'https://p26-doubao-search-sign.byteimg.com/labis/4f12a246d0c6ec6c828e7d3b40e3009b~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=8gfe%2FMaV%2Fkxb0CyCh4ZA4daf6g4%3D', title: '生日气球1' },
            { url: 'https://p26-doubao-search-sign.byteimg.com/labis/352490d47c714e4b2b9f53c52198a5ad~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=ZImgQ%2BJwgZKWH4AkQwDdJEfPSiE%3D', title: '生日气球2' },
            { url: 'https://p26-doubao-search-sign.byteimg.com/labis/e201533038f53c4e1d9fd2408a3dacce~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=PDX2fxNI0tbBqh1pvz4ccR4%2Fj9k%3D', title: '生日气球3' },
            { url: 'https://p3-doubao-search-sign.byteimg.com/labis/98a26773eaa5674624abf5cddc40384c~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=q1llEa23PollzmQLxJuISXbQJJQ%3D', title: '生日气球4' },
            { url: 'https://p3-doubao-search-sign.byteimg.com/labis/image/78abf6a0cc9343ed6faa2059f13e8ae0~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=cbHq4BkUMfiUXtTJyqXmHwuKGoY%3D', title: '生日礼物1' },
            { url: 'https://p3-doubao-search-sign.byteimg.com/labis/b727cc9615780994b33eb3b3936aa61b~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=esshVWeiGjp0yQCyWt3XpEywDDM%3D', title: '生日礼物2' },
            { url: 'https://p3-doubao-search-sign.byteimg.com/labis/e2e16ee9de25079f87647188c0a27ae9~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777291810&x-signature=XxdC6BaeZQn%2B6x%2FVPU4v2W1ewFI%3D', title: '生日礼物3' }
        ];
        
        // 使用sessionStorage存储生日祝福
        let birthdayMessage = sessionStorage.getItem('birthdayMessage') || '亲爱的宝贝，愿你的生日充满阳光、欢笑和爱！愿你每一天都像今天一样快乐！🎉🎂🎈';
        
        // 音频元素
        let audioElement = null;
        
        // 当前轮播索引
        let currentSlide = 0;
        
        // DOM 元素
        const photoCarousel = document.getElementById('photoCarousel');
        const photoGrid = document.getElementById('photoGrid');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const photoViewer = document.getElementById('photoViewer');
        const viewerImage = document.getElementById('viewerImage');
        const closeViewerBtn = document.getElementById('closeViewerBtn');
        const editMessageBtn = document.getElementById('editMessageBtn');
        const messageModal = document.getElementById('messageModal');
        const modalMessageInput = document.getElementById('modalMessageInput');
        const modalCancelBtn = document.getElementById('modalCancelBtn');
        const modalSaveBtn = document.getElementById('modalSaveBtn');
        const photoUpload = document.getElementById('photoUpload');
        
        // 初始化照片轮播
        function initCarousel() {
            photos.forEach((photo, index) => {
                const slide = document.createElement('div');
                slide.className = 'min-w-full h-80 md:h-96 relative';
                slide.innerHTML = `
                    <img src="${photo.url}" alt="${photo.title}" class="w-full h-full object-cover rounded-xl cursor-pointer">
                    <button class="absolute top-2 right-2 bg-red-500/70 hover:bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center transition-all duration-300 opacity-0 hover:opacity-100">
                        <i class="fa fa-trash"></i>
                    </button>
                `;
                slide.querySelector('img').addEventListener('click', () => openPhotoViewer(photo.url, index));
                slide.querySelector('button').addEventListener('click', (e) => {
                    e.stopPropagation();
                    deletePhoto(index);
                });
                photoCarousel.appendChild(slide);
                
                // 添加指示器
                const indicator = document.createElement('div');
                indicator.className = `w-3 h-3 rounded-full ${index === 0 ? 'bg-pink-600' : 'bg-gray-300'} cursor-pointer`;
                indicator.addEventListener('click', () => goToSlide(index));
                document.querySelector('.flex.justify-center.gap-2').appendChild(indicator);
            });
            
            // 设置轮播自动播放
            setInterval(nextSlide, 5000);
        }
        
        // 初始化照片网格
        function initPhotoGrid() {
            photos.forEach((photo, index) => {
                const thumbnail = document.createElement('div');
                thumbnail.className = 'rounded-lg overflow-hidden shadow-md cursor-pointer transform transition-transform duration-300 hover:scale-105 relative';
                thumbnail.innerHTML = `
                    <img src="${photo.url}" alt="${photo.title}" class="w-full h-40 object-cover">
                    <button class="absolute top-2 right-2 bg-red-500/70 hover:bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center transition-all duration-300 opacity-0 hover:opacity-100">
                        <i class="fa fa-trash"></i>
                    </button>
                `;
                thumbnail.querySelector('img').addEventListener('click', () => openPhotoViewer(photo.url, index));
                thumbnail.querySelector('button').addEventListener('click', (e) => {
                    e.stopPropagation();
                    deletePhoto(index);
                });
                photoGrid.appendChild(thumbnail);
            });
        }
        
        // 轮播下一张
        function nextSlide() {
            currentSlide = (currentSlide + 1) % photos.length;
            updateCarousel();
        }
        
        // 轮播上一张
        function prevSlide() {
            currentSlide = (currentSlide - 1 + photos.length) % photos.length;
            updateCarousel();
        }
        
        // 跳转到指定幻灯片
        function goToSlide(index) {
            currentSlide = index;
            updateCarousel();
        }
        
        // 更新轮播状态
        function updateCarousel() {
            photoCarousel.style.transform = `translateX(-${currentSlide * 100}%)`;
            
            // 更新指示器
            const indicators = document.querySelectorAll('.flex.justify-center.gap-2 div');
            indicators.forEach((indicator, index) => {
                indicator.className = `w-3 h-3 rounded-full ${index === currentSlide ? 'bg-pink-600' : 'bg-gray-300'} cursor-pointer`;
            });
        }
        
        // 打开照片查看器
        function openPhotoViewer(url, index) {
            viewerImage.src = url;
            photoViewer.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            // 保存当前查看的照片索引
            photoViewer.dataset.currentIndex = index;
        }
        
        // 关闭照片查看器
        function closePhotoViewer() {
            photoViewer.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
        
        // 打开祝福编辑弹窗
        function openMessageEditor() {
            modalMessageInput.value = document.getElementById('birthdayMessage').textContent.trim();
            messageModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        // 关闭祝福编辑弹窗
        function closeMessageEditor() {
            messageModal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
        
        // 保存生日祝福
        function saveMessage() {
            const newMessage = modalMessageInput.value.trim();
            if (newMessage) {
                // 更新显示
                document.getElementById('birthdayMessage').textContent = newMessage;
                
                // 保存到sessionStorage
                sessionStorage.setItem('birthdayMessage', newMessage);
                
                // 更新变量
                birthdayMessage = newMessage;
                
                closeMessageEditor();
                
                // 显示保存成功动画
                const saveNotification = document.createElement('div');
                saveNotification.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-float';
                saveNotification.textContent = '祝福已保存！';
                document.body.appendChild(saveNotification);
                
                // 3秒后移除通知
                setTimeout(() => {
                    saveNotification.remove();
                }, 3000);
            }
        }
        
        // 处理照片上传
        function handlePhotoUpload(event) {
            const files = event.target.files;
            if (files.length > 0) {
                // 显示上传中动画
                const uploadNotification = document.createElement('div');
                uploadNotification.className = 'fixed bottom-4 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-float';
                uploadNotification.textContent = '正在上传照片...';
                document.body.appendChild(uploadNotification);
                
                // 处理每个上传的文件
                Array.from(files).forEach(file => {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        // 创建新照片对象
                        const newPhoto = {
                            url: e.target.result,
                            title: file.name
                        };
                        
                        // 添加到照片数组
                        photos.push(newPhoto);
                        
                        // 保存到sessionStorage
                        savePhotosToSessionStorage();
                        
                        // 更新UI
                        updatePhotoDisplay();
                    };
                    
                    // 读取文件为DataURL
                    reader.readAsDataURL(file);
                });
                
                // 模拟上传延迟后显示成功消息
                setTimeout(() => {
                    uploadNotification.remove();
                    
                    // 显示上传成功动画
                    const successNotification = document.createElement('div');
                    successNotification.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-float';
                    successNotification.textContent = `成功上传 ${files.length} 张照片！`;
                    document.body.appendChild(successNotification);
                    
                    // 3秒后移除通知
                    setTimeout(() => {
                        successNotification.remove();
                    }, 3000);
                }, 1000);
            }
        }
        
        // 保存照片数据到sessionStorage
        function savePhotosToSessionStorage() {
            sessionStorage.setItem('birthdayPhotos', JSON.stringify(photos));
        }
        
        // 更新照片显示
        function updatePhotoDisplay() {
            // 清空现有内容
            photoCarousel.innerHTML = '';
            photoGrid.innerHTML = '';
            document.querySelector('.flex.justify-center.gap-2').innerHTML = '';
            
            // 重新初始化轮播和网格
            initCarousel();
            initPhotoGrid();
            
            // 重置当前幻灯片索引
            currentSlide = 0;
            updateCarousel();
        }
        
        // 删除照片
        function deletePhoto(index) {
            // 从数组中删除照片
            photos.splice(index, 1);
            
            // 保存到sessionStorage
            savePhotosToSessionStorage();
            
            // 更新UI
            updatePhotoDisplay();
            
            // 显示删除成功动画
            const deleteNotification = document.createElement('div');
            deleteNotification.className = 'fixed bottom-4 right-4 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-float';
            deleteNotification.textContent = '照片已删除！';
            document.body.appendChild(deleteNotification);
            
            // 3秒后移除通知
            setTimeout(() => {
                deleteNotification.remove();
            }, 3000);
        }
        
        // 创建随机气球
        function createBalloon() {
            const balloon = document.createElement('div');
            balloon.className = 'balloon';
            
            // 随机大小
            const size = Math.floor(Math.random() * 60) + 40;
            balloon.style.width = `${size}px`;
            balloon.style.height = `${size}px`;
            
            // 随机颜色
            const colors = ['#FF6B8B', '#6BCEFF', '#FFD166', '#06D6A0', '#EF476F', '#118AB2'];
            balloon.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            
            // 随机位置
            const posX = Math.floor(Math.random() * window.innerWidth);
            balloon.style.left = `${posX}px`;
            balloon.style.bottom = '-100px';
            
            // 随机动画延迟
            balloon.style.animationDelay = `${Math.random() * 10}s`;
            
            // 添加到页面
            document.body.appendChild(balloon);
            
            // 动画结束后移除
            setTimeout(() => {
                balloon.remove();
            }, 10000);
        }
        
        // 创建随机彩带
        function createConfetti() {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            
            // 随机颜色
            const colors = ['#FF6B8B', '#6BCEFF', '#FFD166', '#06D6A0', '#EF476F', '#118AB2', '#FF8C42', '#A77DC2'];
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            
            // 随机位置
            const posX = Math.floor(Math.random() * window.innerWidth);
            confetti.style.left = `${posX}px`;
            
            // 随机动画延迟和持续时间
            confetti.style.animationDelay = `${Math.random() * 5}s`;
            confetti.style.animationDuration = `${Math.random() * 5 + 5}s`;
            
            // 添加到页面
            document.body.appendChild(confetti);
            
            // 动画结束后移除
            setTimeout(() => {
                confetti.remove();
            }, 10000);
        }
        
        // 显示上一张照片
        function showPrevPhoto() {
            const currentIndex = parseInt(photoViewer.dataset.currentIndex);
            const newIndex = (currentIndex - 1 + photos.length) % photos.length;
            viewerImage.src = photos[newIndex].url;
            photoViewer.dataset.currentIndex = newIndex;
        }
        
        // 显示下一张照片
        function showNextPhoto() {
            const currentIndex = parseInt(photoViewer.dataset.currentIndex);
            const newIndex = (currentIndex + 1) % photos.length;
            viewerImage.src = photos[newIndex].url;
            photoViewer.dataset.currentIndex = newIndex;
        }
        
        // 删除当前查看的照片
        function deleteCurrentPhoto() {
            const currentIndex = parseInt(photoViewer.dataset.currentIndex);
            deletePhoto(currentIndex);
            closePhotoViewer();
        }
        
        // 处理键盘导航
        function handleKeyNavigation(event) {
            if (!photoViewer.classList.contains('hidden')) {
                switch (event.key) {
                    case 'ArrowLeft':
                        showPrevPhoto();
                        break;
                    case 'ArrowRight':
                        showNextPhoto();
                        break;
                    case 'Escape':
                        closePhotoViewer();
                        break;
                    case 'Delete':
                        deleteCurrentPhoto();
                        break;
                }
            }
        }
        
        // 播放音频
        function playAudio(type) {
            // 模拟音频源
            const audioSources = {
                '生日快乐歌': 'https://example.com/happy-birthday.mp3',
                '儿童欢乐曲': 'https://example.com/children-song.mp3'
            };
            
            // 检查是否支持音频播放
            if (!audioElement) {
                showNotification('您的浏览器不支持音频播放', 'error');
                return;
            }
            
            try {
                // 设置音频源
                audioElement.src = audioSources[type];
                
                // 尝试播放
                audioElement.play()
                    .then(() => {
                        document.getElementById('playPauseBtn').innerHTML = '<i class="fa fa-pause"></i>';
                        showNotification(`正在播放: ${type}`, 'success');
                    })
                    .catch(error => {
                        console.error('播放失败:', error);
                        showNotification('请点击页面后再尝试播放音乐', 'warning');
                        
                        // 提供一个备用按钮
                        const playButton = document.createElement('div');
                        playButton.className = 'fixed bottom-20 right-4 bg-pink-600 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-float';
                        playButton.innerHTML = '<i class="fa fa-play mr-2"></i>点击播放音乐';
                        playButton.addEventListener('click', () => {
                            audioElement.play()
                                .then(() => {
                                    document.getElementById('playPauseBtn').innerHTML = '<i class="fa fa-pause"></i>';
                                    playButton.remove();
                                    showNotification(`正在播放: ${type}`, 'success');
                                })
                                .catch(err => {
                                    showNotification('播放失败，请稍后再试', 'error');
                                    console.error('再次尝试播放失败:', err);
                                });
                        });
                        document.body.appendChild(playButton);
                    });
            } catch (error) {
                console.error('音频播放错误:', error);
                showNotification('音频播放出错，请稍后再试', 'error');
            }
        }
        
        // 处理音乐上传
        function handleMusicUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        audioElement.src = e.target.result;
                        audioElement.play()
                            .then(() => {
                                document.getElementById('playPauseBtn').innerHTML = '<i class="fa fa-pause"></i>';
                                showNotification('正在播放您上传的音乐', 'success');
                            })
                            .catch(error => {
                                console.error('播放上传音乐失败:', error);
                                showNotification('请点击页面后再尝试播放音乐', 'warning');
                            });
                    } catch (error) {
                        console.error('处理上传音乐错误:', error);
                        showNotification('无法处理上传的音乐文件', 'error');
                    }
                };
                
                reader.onerror = function() {
                    showNotification('读取音乐文件时出错', 'error');
                };
                
                reader.readAsDataURL(file);
            }
        }
        
        // 切换播放/暂停
        function togglePlayPause() {
            if (!audioElement) return;
            
            try {
                if (audioElement.paused) {
                    audioElement.play()
                        .then(() => {
                            document.getElementById('playPauseBtn').innerHTML = '<i class="fa fa-pause"></i>';
                        })
                        .catch(error => {
                            console.error('播放失败:', error);
                            showNotification('请点击页面后再尝试播放音乐', 'warning');
                        });
                } else {
                    audioElement.pause();
                    document.getElementById('playPauseBtn').innerHTML = '<i class="fa fa-play"></i>';
                }
            } catch (error) {
                console.error('切换播放状态错误:', error);
                showNotification('操作出错，请稍后再试', 'error');
            }
        }
        
        // 调整音量
        function adjustVolume() {
            if (!audioElement) return;
            
            try {
                const volume = document.getElementById('volumeSlider').value / 100;
                audioElement.volume = volume;
            } catch (error) {
                console.error('调整音量错误:', error);
            }
        }
        
        // 更新音频进度
        function updateAudioProgress() {
            if (!audioElement) return;
            
            try {
                const currentMinutes = Math.floor(audioElement.currentTime / 60);
                const currentSeconds = Math.floor(audioElement.currentTime % 60);
                const totalMinutes = Math.floor(audioElement.duration / 60);
                const totalSeconds = Math.floor(audioElement.duration % 60);
                
                document.getElementById('currentTime').textContent = 
                    `${currentMinutes.toString().padStart(2, '0')}:${currentSeconds.toString().padStart(2, '0')}`;
                document.getElementById('totalTime').textContent = 
                    `${totalMinutes.toString().padStart(2, '0')}:${totalSeconds.toString().padStart(2, '0')}`;
            } catch (error) {
                // 忽略NaN错误
                if (!isNaN(error)) {
                    console.error('更新音频进度错误:', error);
                }
            }
        }
        
        // 显示通知
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            
            // 设置样式
            let bgColor = 'bg-blue-500';
            if (type === 'success') bgColor = 'bg-green-500';
            if (type === 'error') bgColor = 'bg-red-500';
            if (type === 'warning') bgColor = 'bg-yellow-500';
            
            notification.className = `fixed bottom-4 right-4 ${bgColor} text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-float`;
            notification.textContent = message;
            
            // 添加到页面
            document.body.appendChild(notification);
            
            // 3秒后移除
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 初始化轮播和网格
            initCarousel();
            initPhotoGrid();
            
            // 加载保存的生日祝福
            document.getElementById('birthdayMessage').textContent = birthdayMessage;
            
            // 绑定事件
            prevBtn.addEventListener('click', prevSlide);
            nextBtn.addEventListener('click', nextSlide);
            closeViewerBtn.addEventListener('click', closePhotoViewer);
            editMessageBtn.addEventListener('click', openMessageEditor);
            modalCancelBtn.addEventListener('click', closeMessageEditor);
            modalSaveBtn.addEventListener('click', saveMessage);
            photoUpload.addEventListener('change', handlePhotoUpload);
            
            // 照片查看器导航按钮
            document.getElementById('prevPhotoBtn').addEventListener('click', showPrevPhoto);
            document.getElementById('nextPhotoBtn').addEventListener('click', showNextPhoto);
            document.getElementById('deletePhotoBtn').addEventListener('click', deleteCurrentPhoto);
            
            // 键盘导航
            document.addEventListener('keydown', handleKeyNavigation);
            
            // 音频相关事件
            document.getElementById('playHappyBirthday').addEventListener('click', () => playAudio('生日快乐歌'));
            document.getElementById('playChildrenSong').addEventListener('click', () => playAudio('儿童欢乐曲'));
            document.getElementById('musicUpload').addEventListener('change', handleMusicUpload);
            document.getElementById('playPauseBtn').addEventListener('click', togglePlayPause);
            document.getElementById('volumeSlider').addEventListener('input', adjustVolume);
            
            // 获取音频元素
            audioElement = document.getElementById('birthdayAudio');
            
            // 音频时间更新事件
            audioElement.addEventListener('timeupdate', updateAudioProgress);
            
            // 音频结束事件
            audioElement.addEventListener('ended', () => {
                document.getElementById('playPauseBtn').innerHTML = '<i class="fa fa-play"></i>';
            });
            
            // 显示音频控制器
            document.getElementById('audioControls').classList.remove('hidden');
            
            // 点击页面创建气球和彩带
            document.addEventListener('click', (event) => {
                // 排除特定元素
                const excludedElements = ['button', 'input', 'textarea', '.balloon', '.confetti'];
                const isExcluded = excludedElements.some(selector => 
                    event.target.matches(selector) || event.target.closest(selector)
                );
                
                if (!isExcluded) {
                    createBalloon();
                    createConfetti();
                }
            });
            
            // 自动创建气球和彩带
            setInterval(() => {
                createBalloon();
                createConfetti();
            }, 2000);
        });
    </script>
</body>
</html>
