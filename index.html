<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç±³å°å…œAIåŠ©æ‰‹</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #5E81F4;
      --primary-light: #8EA7F9;
      --primary-dark: #3D63D4;
      --secondary: #FF7AC6;
      --bg-light: #F5F7FF;
      --bg-white: #FFFFFF;
      --text-dark: #2E384D;
      --text-light: #8C94A7;
      --shadow: 0 10px 30px rgba(94, 129, 244, 0.15);
      --radius: 16px;
    }

    body {
      font-family: 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #F5F7FF 0%, #E6EBFF 100%);
      min-height: 100vh;
      padding: 20px;
      color: var(--text-dark);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      width: 100%;
      max-width: 800px;
      background: var(--bg-white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: 90vh;
    }

    .header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 20px 30px;
      text-align: center;
      position: relative;
    }

    .header h1 {
      font-size: 1.8rem;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .header p {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .status-indicator {
      position: absolute;
      top: 20px;
      right: 20px;
      display: flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.2);
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #4CD964;
      margin-right: 8px;
    }

    /* èŠå¤©åŒºåŸŸæ ·å¼ */
    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 20px;
      overflow: hidden;
    }

    #chat {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
    }

    .message {
      max-width: 80%;
      padding: 12px 18px;
      margin-bottom: 15px;
      border-radius: 18px;
      line-height: 1.4;
      position: relative;
      animation: fadeIn 0.3s ease;
    }

    .user-message {
      align-self: flex-end;
      background: var(--primary);
      color: white;
      border-bottom-right-radius: 6px;
    }

    .ai-message {
      align-self: flex-start;
      background: var(--bg-light);
      color: var(--text-dark);
      border-bottom-left-radius: 6px;
    }

    .message-time {
      font-size: 0.7rem;
      opacity: 0.7;
      margin-top: 5px;
      text-align: right;
    }

    .ai-message .message-time {
      text-align: left;
    }

    /* è¾“å…¥åŒºåŸŸ */
    .input-container {
      display: flex;
      background: var(--bg-light);
      border-radius: 24px;
      padding: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    #userInput {
      flex: 1;
      border: none;
      background: transparent;
      padding: 12px 20px;
      font-size: 1rem;
      outline: none;
      color: var(--text-dark);
    }

    #userInput::placeholder {
      color: var(--text-light);
    }

    .action-buttons {
      display: flex;
      gap: 8px;
    }

    .btn {
      background: var(--primary);
      color: white;
      border: none;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 4px 8px rgba(94, 129, 244, 0.3);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(94, 129, 244, 0.4);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-voice {
      background: var(--secondary);
      box-shadow: 0 4px 8px rgba(255, 122, 198, 0.3);
    }

    .btn-voice.listening {
      animation: pulse 1.5s infinite;
    }

    .btn-speak {
      background: var(--primary-light);
    }

    .btn:disabled {
      background: var(--text-light);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .voice-status {
      text-align: center;
      margin: 10px 0;
      color: var(--primary);
      font-size: 0.9rem;
      min-height: 20px;
    }

    /* åŠ¨ç”» */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 122, 198, 0.7); }
      70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(255, 122, 198, 0); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 122, 198, 0); }
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 600px) {
      .container {
        height: 95vh;
      }
      
      .header {
        padding: 15px 20px;
      }
      
      .header h1 {
        font-size: 1.5rem;
      }
      
      .chat-container {
        padding: 15px;
      }
      
      .message {
        max-width: 90%;
      }
    }

    /* æ»šåŠ¨æ¡æ ·å¼ */
    #chat::-webkit-scrollbar {
      width: 6px;
    }

    #chat::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }

    #chat::-webkit-scrollbar-thumb {
      background: var(--primary-light);
      border-radius: 10px;
    }

    #chat::-webkit-scrollbar-thumb:hover {
      background: var(--primary);
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- å¤´éƒ¨ -->
    <div class="header">
      <h1>ç±³å°å…œAIåŠ©æ‰‹</h1>
      <p>æ‚¨çš„æ™ºèƒ½å¯¹è¯ä¼™ä¼´</p>
      <div class="status-indicator">
        <div class="status-dot"></div>
        <span>åœ¨çº¿</span>
      </div>
    </div>

    <!-- èŠå¤©åŒºåŸŸ -->
    <div class="chat-container">
      <div id="chat">
        <div class="message ai-message">
          å—¨ï¼æˆ‘æ˜¯ç±³å°å…œï¼Œæ‚¨çš„AIåŠ©æ‰‹ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®æ‚¨çš„å—ï¼Ÿ
          <div class="message-time">åˆšåˆš</div>
        </div>
      </div>
      
      <div class="voice-status" id="voiceStatus"></div>
      
      <div class="input-container">
        <input type="text" id="userInput" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜...">
        <div class="action-buttons">
          <button class="btn btn-voice" id="voiceButton" onclick="toggleVoiceRecognition()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
              <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
              <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
            </svg>
          </button>
          <button class="btn" onclick="sendMessage()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
              <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
            </svg>
          </button>
          <button class="btn btn-speak" onclick="speakLastMessage()" id="speakButton" disabled>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
              <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ğŸ”‘ é…ç½®ä½ çš„APIä¿¡æ¯ - è¯·æ›¿æ¢æˆä½ è‡ªå·±çš„ï¼
    const API_KEY = 'sk-cf810705e966476eb6aabf5651e42163'; // è¯·åœ¨æ­¤å¤„å¡«å…¥ä½ ä»é˜¿é‡Œäº‘ç™¾ç‚¼è·å–çš„APIå¯†é’¥
    const API_URL = 'https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions'; // åƒé—®çš„OpenAIå…¼å®¹æ¥å£åœ°å€
    const MODEL_NAME = 'qwen-plus'; // ä½ æ‰“ç®—ä½¿ç”¨çš„æ¨¡å‹åç§°ï¼Œä¾‹å¦‚ qwen-max, qwen-turbo ç­‰

    // ç”¨äºä¿å­˜å¯¹è¯å†å²ï¼Œè®©AIæœ‰ä¸Šä¸‹æ–‡è®°å¿†
    let conversationHistory = [
      { 
        role: "system", 
        content: "ä½ æ˜¯ä¸€ä¸ªåå«ç±³å°å…œçš„AIåŠ©æ‰‹ï¼Œå›ç­”é£æ ¼äº²åˆ‡å‹å–„ã€ä¸“ä¸šä¸”ç®€æ´ã€‚ä½ ä¸“æ³¨äºå¸®åŠ©ç”¨æˆ·è§£å†³é—®é¢˜ï¼Œæä¾›æœ‰ç”¨çš„ä¿¡æ¯å’Œå»ºè®®ã€‚" 
      }
    ];

    // è¯­éŸ³è¯†åˆ«ç›¸å…³å˜é‡
    let recognition = null;
    let isListening = false;
    let lastAIResponse = "";
    
    // è·å–å½“å‰æ—¶é—´
    function getCurrentTime() {
      const now = new Date();
      return `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
    }
    
    // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒè¯­éŸ³è¯†åˆ«
    function initializeSpeechRecognition() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      
      if (!SpeechRecognition) {
        document.getElementById('voiceStatus').textContent = "æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨Chromeæˆ–Edgeæµè§ˆå™¨";
        document.getElementById('voiceButton').disabled = true;
        return false;
      }
      
      recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = 'zh-CN';
      
      recognition.onstart = function() {
        isListening = true;
        document.getElementById('voiceButton').classList.add('listening');
        document.getElementById('voiceStatus').textContent = "æ­£åœ¨è†å¬...è¯·è¯´è¯";
      };
      
      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        document.getElementById('userInput').value = transcript;
        document.getElementById('voiceStatus').textContent = `è¯†åˆ«ç»“æœ: ${transcript}`;
        
        // è‡ªåŠ¨å‘é€è¯†åˆ«åˆ°çš„è¯­éŸ³å†…å®¹
        setTimeout(() => {
          sendMessage();
        }, 500);
      };
      
      recognition.onerror = function(event) {
        console.error('è¯­éŸ³è¯†åˆ«é”™è¯¯:', event.error);
        document.getElementById('voiceStatus').textContent = `è¯†åˆ«é”™è¯¯: ${event.error}`;
        stopVoiceRecognition();
      };
      
      recognition.onend = function() {
        stopVoiceRecognition();
      };
      
      return true;
    }
    
    // å¼€å§‹æˆ–åœæ­¢è¯­éŸ³è¯†åˆ«
    function toggleVoiceRecognition() {
      if (!recognition) {
        if (!initializeSpeechRecognition()) {
          return;
        }
      }
      
      if (isListening) {
        stopVoiceRecognition();
      } else {
        startVoiceRecognition();
      }
    }
    
    // å¼€å§‹è¯­éŸ³è¯†åˆ«
    function startVoiceRecognition() {
      try {
        recognition.start();
      } catch (error) {
        console.error('å¯åŠ¨è¯­éŸ³è¯†åˆ«å¤±è´¥:', error);
        document.getElementById('voiceStatus').textContent = "å¯åŠ¨è¯­éŸ³è¯†åˆ«å¤±è´¥ï¼Œè¯·é‡è¯•";
      }
    }
    
    // åœæ­¢è¯­éŸ³è¯†åˆ«
    function stopVoiceRecognition() {
      if (recognition && isListening) {
        recognition.stop();
      }
      isListening = false;
      document.getElementById('voiceButton').classList.remove('listening');
    }
    
    // è¯­éŸ³åˆæˆ - æœ—è¯»AIçš„å›å¤
    function speakText(text) {
      // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒè¯­éŸ³åˆæˆ
      if (!('speechSynthesis' in window)) {
        alert("æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½");
        return;
      }
      
      // åœæ­¢ä»»ä½•æ­£åœ¨è¿›è¡Œçš„è¯­éŸ³
      window.speechSynthesis.cancel();
      
      // åˆ›å»ºè¯­éŸ³å®ä¾‹
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'zh-CN';
      utterance.rate = 1.0; // æ­£å¸¸è¯­é€Ÿ
      utterance.pitch = 1.0; // æ­£å¸¸éŸ³è°ƒ
      
      utterance.onstart = function() {
        document.getElementById('voiceStatus').textContent = "æ­£åœ¨æœ—è¯»å›å¤...";
        document.getElementById('speakButton').disabled = true;
      };
      
      utterance.onend = function() {
        document.getElementById('voiceStatus').textContent = "";
        document.getElementById('speakButton').disabled = false;
      };
      
      // å¼€å§‹æœ—è¯»
      window.speechSynthesis.speak(utterance);
    }
    
    // æœ—è¯»æœ€åä¸€æ¡AIæ¶ˆæ¯
    function speakLastMessage() {
      if (lastAIResponse) {
        speakText(lastAIResponse);
      } else {
        document.getElementById('voiceStatus').textContent = "æ²¡æœ‰å¯æœ—è¯»çš„å›å¤";
      }
    }

    // å‘é€æ¶ˆæ¯å‡½æ•° - æ¥å…¥åƒé—®API
    async function sendMessage() {
      const userInput = document.getElementById('userInput');
      const message = userInput.value.trim();
      
      if (!message) return;

      const chatBox = document.getElementById('chat');
      const currentTime = getCurrentTime();
      
      // åœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºç”¨æˆ·è¾“å…¥
      chatBox.innerHTML += `
        <div class="message user-message">
          ${message}
          <div class="message-time">${currentTime}</div>
        </div>
      `;
      userInput.value = '';
      
      // æ˜¾ç¤º"æ€è€ƒä¸­"çš„æç¤º
      const thinkingId = "thinking-" + Date.now();
      chatBox.innerHTML += `
        <div class="message ai-message" id="${thinkingId}">
          ç±³å°å…œæ­£åœ¨æ€è€ƒ...
          <div class="message-time">${currentTime}</div>
        </div>
      `;
      chatBox.scrollTop = chatBox.scrollHeight;

      try {
        // å°†ç”¨æˆ·çš„æ–°æ¶ˆæ¯åŠ å…¥å†å²
        conversationHistory.push({ role: "user", content: message });

        // è°ƒç”¨åƒé—®API
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${API_KEY}` // è®¤è¯ä¿¡æ¯
          },
          body: JSON.stringify({
            model: MODEL_NAME,
            messages: conversationHistory, // å‘é€å®Œæ•´çš„å¯¹è¯å†å²
            temperature: 0.7 // æ§åˆ¶å›ç­”çš„éšæœºæ€§ï¼Œ0-1ä¹‹é—´ï¼Œè¶Šå°è¶Šç¡®å®š
          })
        });

        if (!response.ok) {
          throw new Error(`ç½‘ç»œè¯·æ±‚é”™è¯¯: ${response.status}`);
        }

        const data = await response.json();
        
        // ä»APIå›å¤ä¸­æå–AIçš„å›ç­”æ–‡æœ¬
        const aiReply = data.choices[0].message.content;
        lastAIResponse = aiReply; // ä¿å­˜æœ€åä¸€æ¡AIå›å¤ç”¨äºè¯­éŸ³æœ—è¯»
        
        // å°†AIçš„å›ç­”ä¹ŸåŠ å…¥å†å²
        conversationHistory.push({ role: "assistant", content: aiReply });

        // ç”¨AIçš„çœŸå®å›å¤æ›¿æ¢"æ€è€ƒä¸­"æç¤º
        document.getElementById(thinkingId).outerHTML = `
          <div class="message ai-message">
            ${aiReply}
            <div class="message-time">${getCurrentTime()}</div>
          </div>
        `;
        
        // å¯ç”¨æœ—è¯»æŒ‰é’®
        document.getElementById('speakButton').disabled = false;
        
      } catch (error) {
        console.error('å‡ºé”™äº†:', error);
        // ç”¨é”™è¯¯ä¿¡æ¯æ›¿æ¢"æ€è€ƒä¸­"æç¤º
        document.getElementById(thinkingId).outerHTML = `
          <div class="message ai-message">
            æŠ±æ­‰ï¼Œæˆ‘æš‚æ—¶æ— æ³•å›åº”ã€‚é”™è¯¯è¯¦æƒ…: ${error.message}
            <div class="message-time">${getCurrentTime()}</div>
          </div>
        `;
      }
      
      // ç¡®ä¿èŠå¤©æ¡†æ»šåŠ¨åˆ°åº•éƒ¨
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // æ”¯æŒæŒ‰å›è½¦é”®å‘é€æ¶ˆæ¯
    document.getElementById('userInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });

    // åˆå§‹åŒ–è¯­éŸ³è¯†åˆ«
    window.onload = function() {
      initializeSpeechRecognition();
      
      const chat = document.getElementById('chat');
      setTimeout(() => {
        chat.innerHTML += `
          <div class="message ai-message">
            æ‚¨å¯ä»¥ä½¿ç”¨æ–‡å­—æˆ–è¯­éŸ³ä¸æˆ‘äº¤æµï¼Œç‚¹å‡»éº¦å…‹é£æŒ‰é’®å¼€å§‹è¯­éŸ³å¯¹è¯ã€‚
            <div class="message-time">${getCurrentTime()}</div>
          </div>
        `;
        chat.scrollTop = chatBox.scrollHeight;
      }, 1000);
    };
  </script>
</body>
</html>